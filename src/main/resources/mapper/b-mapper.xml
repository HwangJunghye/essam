<?xml version="1.0" encoding="UTF-8"?>
<!-- mapper(sql문) 작성 -->
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" 
"http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.essam.www.b.IBDao">

	<select id="getClassListNew" resultType="classbean">
	<![CDATA[
		SELECT /*+INDEX_DESC(CLASS PK_CLASS)*/ ROWNUM RN, CLASS.*
		FROM CLASS
		WHERE ROWNUM<=5
	]]>
	</select>
	<select id="getClassListMy" resultType="classbean" parameterType="string">
		SELECT C.clsNo,C.clsName,C.mbId FROM CLASS C JOIN STUDENT S ON C.clsNo=S.clsNo WHERE S.MBID=#{mbId}
	</select>
	<select id="getClassInfo" resultType="classbean">
		SELECT CLASS.*, CATE1.CATE1NAME, CATE2.CATE2NAME
		FROM CLASS
			LEFT JOIN CATE1
			ON CLASS.CATE1NO = CATE1.CATE1NO
			LEFT JOIN CATE2
			ON CLASS.CATE2NO = CATE2.CATE2NO
		WHERE CLSNO=#{clsNo} AND ROWNUM=1
	</select>
	<select id="getClassRegiCnt" resultType="int">
		SELECT COUNT(*) 
		FROM STUDENT 
		WHERE clsNo=#{clsNo}
	</select>
	<insert id="classJoin">
		INSERT INTO STUDENT (regiNo, clsNo, mbId, regiStartDate)
		VALUES (STUDENT_SEQ.NEXTVAL, #{clsNo}, #{mbId}, DEFALUT)
	</insert>
	<select id="getBoardList" resultType="boardbean">
	<![CDATA[
      SELECT * FROM (
        SELECT
		  /*+INDEX_DESC(C PK_CLS_BRD)*/ ROWNUM RN, 
		  C.*,
		  NVL(V.clsBrdViewS, 0) clsBrdView,
          mbNickName
		FROM
		  CLS_BRD C
		  LEFT OUTER JOIN (SELECT CLSBRDNO, COUNT(*) clsBrdViewS FROM CLS_BRD_VIEW GROUP BY CLSBRDNO) V
		  		ON C.CLSBRDNO = V.CLSBRDNO
          JOIN MEMBER M ON C.MBID=M.MBID
		WHERE C.clsNo=#{clsNo} AND C.clsBrdType=#{clsBrdType} AND ROWNUM<=#{pageNum}*10)
	  WHERE RN>=#{pageNum}*10-9
	]]>
	</select>
	<select id="getBoardCount" resultType="int">
		SELECT COUNT(*) FROM CLS_BRD WHERE clsNo=#{clsNo} AND clsBrdType=#{clsBrdType}
	</select>
	<select id="getBoardFiles" resultType="int">
		SELECT COUNT(*) FROM BRD_FILE WHERE clsBrdNo=#{clsBrdNo}	
	</select>
	<select id="getBoardRead" resultType="boardbean">
		SELECT mbNickName, C.* FROM CLS_BRD C 
		JOIN MEMBER M ON C.MBID=M.MBID WHERE clsBrdNo=#{clsBrdNo}
	</select>
</mapper>