<?xml version="1.0" encoding="UTF-8"?>
<!-- mapper(sql문) 작성 -->
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" 
"http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.essam.www.member.IMemberDao">
	<insert id="memberJoin">
		INSERT INTO 
		MEMBER(
			MBID,
			MBTYPE,
			MBNAME,
			MBPWD,
			MBNICKNAME,
			MBTEL,
			MBADDR,
			MBBIRTH,
			MBJOINDATE,
			MBGENDER
			) 
		VALUES(
			#{mbId},
			#{mbType},
			#{mbName},
			#{mbPwd},
			#{mbNickName},
			#{mbTel},
			#{mbAddr},
			#{mbBirth},
			SYSDATE,
			#{mbGender}
			)
	</insert>
	
	<insert id="putInterCate">
		INSERT INTO ${tablenm} VALUES (#{mbid}, #{cateno})
	</insert>
	
	<select id="getMemberInfo" resultType="memberbean">
		SELECT * FROM MEMBER WHERE MBID=#{mbId} AND ROWNUM=1
	</select>
	
	<select id="checkEmail" resultType="boolean">
		SELECT COUNT(*) FROM MEMBER WHERE MBID=#{mbId} AND ROWNUM=1
	</select>
	
	<select id="getMyClassList" resultType="classbean">
		SELECT * 
		FROM V_CLASSBEAN
		<if test="mbtype==2">
		WHERE MBID=#{mbid}
		</if>
		<if test="mbtype==1">
		WHERE CLSNO IN
			(
				SELECT C.CLSNO
				FROM CLASS C
				JOIN (
					SELECT STUDENT.CLSNO CLSNO
					FROM STUDENT
					WHERE STUDENT.MBID = #{mbid}
					) S
				ON C.CLSNO = S.CLSNO
			)
		</if>
	</select>
	
	<insert id="putTeacher" parameterType="String">
		INSERT INTO TEACHER(MBID,TEACHERGRADE) VALUES(#{mbId}, 0)
	</insert>
	
		<update id="changePassword">
		UPDATE MEMBER 
		SET MBPWD = #{mbPwd} 
		WHERE MBID = #{mbId}
	</update>
</mapper>